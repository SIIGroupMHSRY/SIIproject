<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css">
 <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
 <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
<link rel="stylesheet" href="libraries/leaflet-0.7/leaflet.css" />
    <link rel="stylesheet" href="libraries/Leaflet.draw/dist/leaflet.draw.css" />
	<link rel="stylesheet" href="libraries/MiniMap/fullscreen.css" />
	<link rel="stylesheet" href="libraries/MiniMap/src/Control.MiniMap.css" />
<!-- HEAD-->
	<link rel="stylesheet" href="libraries/Measure/leaflet.measurecontrol.css" />
	<link rel="stylesheet" href="libraries/L.Control.Sidebar.css" />
	
	<script src="http://cdn.leafletjs.com/leaflet-0.7/leaflet.js"></script>
	<script src="libraries/Leaflet.draw/dist/leaflet.draw.js" type="text/javascript"></script>
    <script src="libraries/MiniMap/src/Control.MiniMap.js" type="text/javascript"></script>
	<script src="libraries/Measure/leaflet.measurecontrol.js" type="text/javascript"></script>
	
	<script type='text/javascript' src="libraries/GeometryUtil/dist/leaflet.geometryutil.js"></script>
	<script type='text/javascript' src="libraries/leaflet.almostover.js"></script>
	<script src="libraries/jQuery.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script type="text/javascript" src="libraries/L.Control.Sidebar.js"></script>
<!-- created style sheets and scripts-->
<link href="libraries/bootstrap/css/bootstrap.css" rel="stylesheet">
<script type="text/javascript" src="libraries/L.Control.Sidebar.js"></script>
<script type="text/javascript" src="libraries/custom.js"></script>
<!--<link rel="stylesheet" href="libraries/custom_css.css"/>-->


<!-- awesome markers-->
 <script src="dist/leaflet.awesome-markers.js"></script>
 <link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.0/css/font-awesome.css" rel="stylesheet">
  <link rel="stylesheet" href="dist/leaflet.awesome-markers.css">

<!-- custom 
<script type='text/javascript' src="libraries/custom/custom_functions.js"></script>-->
<style>
#map { 
            position: absolute;
            top:0;
            left: 0;
            right: 0;
            bottom:0;
        }
        .leaflet-control.enabled a {
            background-color: yellow;
        }

</style>
 <style type="text/css">
        #qsizemin {
            width: 60px;
        }
        #qpricemin {
            width: 60px;
        }
        #qminlodger {
            width: 60px;
        }
        #qsizemax {
            width: 60px;
        }
        #qpricemax {
            width: 60px;
        }
        #qmaxlodger {
            width: 60px;
        }
        #qminroom {
            width: 60px;
        }
        #qzip {
            width: 60px;
        }
        #qmaxroom {
            width: 60px;
        }
    </style>

	
<meta charset="utf-8">
<title>Find your new living place</title>



<link rel="shortcut icon" href="libraries/head.png" type="image/x-icon" />

</head>
<body>

<body style="background-color:#000000">

<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
		  <!--<div style="position:absolute;left:30%;top:20%;"><button type="button" onclick="Query()">Query</button></div>-->
		  <a class="navbar-brand" href="index.html">Accomodations</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
			<li onclick="alldata()" class="active"><a href="#">Map</a></li>
			<!--<li onclick="Observation()"><a href="#">Add room(s)</a></li>-->
			<li onclick="InvokeMarker()"><a href="#">Add Accomodation</a></li>
            <li onclick="Query()"><a href="#">Search Accommodation</a></li>
			<li onclick="mylocation();Querylocation();"><a href="#">ShowDistance</a></li>
			<li onclick="QuerylocationEnd();"><a href="#">HideDistance</a></li>
			<li onclick="mylocation()"><a href="#">Get my location</a></li>
			<!--<li onclick="InvokeMarker()"><a href="#">New Accommodation</a></li>-->
			
			<li onclick="LinksShow()"><a href="#">Further links</a></li>
			<li onclick="startButton(event)"><a href="#">SpeechControl</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

<!-- HEAD-->
<div class="container">
 <div id="map" style="position:absolute;left:25px; top:51px; width: 96%; height: 80%;" >
 
  <div id="AddAccomodationsidebar"> 
	<div id="NewAccomationCoordinates"></div>
  </div>
  
  <div id="InsertObservationSidebar">
	<div id="coordinateValues"></div>
  </div>
  
 <!-- Observation sidebar -->

 <div id="observation_sidebar"> 
	<br> <b><font style="color: #3366ff;" size=4px>Enter accomodation details:  </b></font>
	<br><br>
	
	<div style="padding-top:10px">
	<b><font style="color: #3366ff;" size=3px> Location details (auto-generated):<b></font>
	</div><!--
	<div style="border: thin solid #000000; border-bottom-width: 0px;">
	</div>-->
	<div style="padding-top:10px">
			<font style="color: #3366ff;">Latitude :</font> &nbsp <input type="text" style="width: 70px" id="obsLatitude" name="obsLatitude">&nbsp&nbsp&nbsp&nbsp
			<font style="color: #3366ff;">Longitude :</font> &nbsp <input type="text" style="width: 70px" id="obsLongitude" name="obsLongitude"><br>
	</div>

	<div style="padding-top:15px">
	<b><font style="color: #3366ff;" size=3px> Address Details</b></font>
	</div><!--
	<div style="border: thin solid #000000; border-bottom-width: 0px;">
	</div>-->
	<div style="padding-top:10px">
		<font style="color: #3366ff;">Street :</font>&nbsp <input type="text" style="width: 70px" id="obsStreet" name="obsStreet">&nbsp&nbsp&nbsp&nbsp
		<font style="color: #3366ff;">Zip :</font>&nbsp;<input type="text" style="width: 70px" id="obsZip" name="obsZip"><br><br>
		<font style="color: #3366ff;">City :</font>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <input type="text" style="width: 70px" id="obsCity" name="obsCity">
		 <font style="color: #3366ff;">Area :</font>&nbsp <input type="text" style="width: 70px" id="obsArea" name="obsArea"><br>
	</div>
	<div style="padding-top:15px">
		<b><font style="color: #3366ff;" size=3px> Rent in &#8364;</b></font>
	</div><!--
	<div style="border: thin solid #000000; border-bottom-width: 0px;">
	</div>-->
	<div style="padding-top:10px">
		&nbsp <input type="text" style="width: 70px" id="obsRent" name="obsRent"><br>
	</div>
	
	<div style="padding-top:15px">
	<b><font style="color: #3366ff;" size=3px>Type</b></font>
	</div><!--
	<div style="border: thin solid #000000; border-bottom-width: 0px;">
	</div>-->
	<div style="padding-top:10px">
		<input type="radio" id="obsTypeFlat" name="obsType" value="Flat">&nbsp;<font  style="color: #3366ff;">Flat</font> &nbsp;&nbsp;
		<input type="radio" id="obsTypeWG" name="obsType" value="WG">&nbsp; <font style="color: #3366ff;">WG</font>
	</div>
	
	<div style="padding-top:15px">
	<b><font style="color: #3366ff;" size=3px>Number of fellow lodger</b></font>
	</div><!--
	<div style="border: thin solid #000000; border-bottom-width: 0px;">
	</div>-->
	<div style="padding-top:10px">
		<input type="text" style="width: 70px" id="obsFellowLodger" name="obsFellowLodger">		
	</div>

	<div style="padding-top:15px">
	<b><font style="color: #3366ff;" size=3px>Number of rooms</b></font>
	</div><!--
	<div style="border: thin solid #000000; border-bottom-width: 0px;">
	</div>-->
	<div style="padding-top:10px">
		 &nbsp <input type="text" style="width: 70px" id="obsNoOfRoom" name="obsNoOfRoom">		 
	</div>
	
	<div style="padding-top:15px">
		<b><font style="color: #3366ff;" size=3px>Move-in date</b></font>
		</div><!--
		<div style="border: thin solid #000000; border-bottom-width: 0px;">
		</div>-->
		<div style="padding-top:10px">
		 &nbsp <input type="text" style="width: 70px" id="obsDate" name="obsDate"><font style="color: #3366ff;" size=2> &nbsp;(YYYY-MM-DD)</b></font>		 
	</div>
	
	<div style="padding-top:15px">
	<b><font style="color: #3366ff;" size=3px>Other information</b></font>
	</div><!--
	<div style="border: thin solid #000000; border-bottom-width: 0px;">
	</div>-->
	<div style="padding-top:10px">
		 <textarea style="width: 250px" rows="4" cols="30" id="obsInformation" name="obsInformation"></textarea>
	</div>
	
	<br>
	<button type="button" onclick="clearRoomDetails()">Clear</button>
	<button type="button" onclick="addRoomDetails()">Submit</button>
	<br><br>
</div>


 
              













 <div id="sidebarLinks"> 

<h>Here are some useful further links to get a room.</h>
<br>
<p>
<a target="_blank" href="http://www.wg-gesucht.de">wg-gesucht</a><br> This is a link to a page on wg-gesucht.
</p>
<p >
<a target="_blank" href="http://www.studierzimmer-muenster.de/">studierzimmer-muenster</a><br> This is a link to a website on the studierzimmer-muenster.
</p>
<p>
<a target="_blank" href="http://www.muenster.de/stadt/wohnungsamt/tipps_liste.html">stadtwerk-muenster</a><br> This is a link to a website on the stadtwerk-muenster.
</p>
</div>











<!-- QUERY FORMULAR-->
 <div id="sidebar"> 
	<p>
			<span style="color: #3366ff;"><strong><span style="font-size: medium;">Search For Accommodation</span></strong></span><img alt="" src="libraries/Images/Search3.png" style="width: 100px; height: 100px" /></p>
	<div style="padding-top: 10px;">
			<table border="0">
				<tbody>
					<tr>
						<td style="text-align: left;">
							<strong>
							<span style="color: #3366ff; ">size in m</span><span style="color: #3366ff; font-size: small;"><sup>2</sup></span></strong></td>
						<td>
							<strong>Min</strong></td>
						<td>
							&nbsp;<input id="qsizemin" type="text" /></td>
						<td>
							<strong>Max</strong></td>
						<td>
							<input id="qsizemax" type="text" /></td>
					</tr>
					<tr>
						<td style="text-align: left;" colspan="5">
							&nbsp;</td>
					</tr>
					<tr>
						<td style="text-align: left;">
							<span style="color: #3366ff; "><strong>price in &euro;</strong></span></td>
						<td>
							&nbsp;<strong>Min</strong></td>
						<td>
							&nbsp;<input id="qpricemin" type="text" /></td>
						<td>
							&nbsp;<strong>Max</strong></td>
						<td>
							<input id="qpricemax" type="text" /></td>
					</tr>
					<tr>
						<td style="text-align: left;" class="auto-style1" colspan="5">
							</td>
					</tr>
					<tr>
						<td style="text-align: left;">
							<span style="color: #3366ff; "><strong>Type</strong></span></td>
						<td>
							&nbsp;</td>
						<td>
							&nbsp;<strong><input id="qflat" type="radio" />Flat</strong></td>
						<td colspan="2">
							&nbsp;<input id="qfsc" type="radio" /><strong>&nbsp;WG</strong></td>
					</tr>
					<tr>
						<td style="text-align: left;" colspan="5">
							&nbsp;</td>
					</tr>
					<tr>
						<td style="text-align: left;">
							<span style="color: #3366ff; "><strong>Number of fellow lodger</strong></span></td>
						<td>
							<strong>Min</strong></td>
						<td>
							&nbsp;<input id="qminlodger" type="text" /></td>
						<td>
							&nbsp;<strong>Max</strong></td>
						<td>
							<input id="qmaxlodger" type="text" /></td>
					</tr>
					<tr>
						<td style="text-align: left;" colspan="5">
							&nbsp;</td>
					</tr>
					<tr>
						<td style="text-align: left;">
							<span style="color: #3366ff; "><strong>Number of Rooms</strong></span></td>
						<td>
							&nbsp;<strong>Min</strong></td>
						<td>
							<input id="qminroom" type="text" /></td>
						<td>
							&nbsp;<strong>Max</strong></td>
						<td>
							&nbsp;<input id="qmaxroom" type="text" /></td>
					</tr>
					<tr>
						<td style="text-align: left;" colspan="5">
							&nbsp;</td>
					</tr>
					<tr>
						<td style="text-align: left;">
							<span style="color: #3366ff; font-size: small;">&nbsp;</span><span style="color: #3366ff; "><strong>Zip Code:</strong></span></td>
						<td>
							&nbsp;</td>
						<td colspan="2">
							<input id="qzip" type="text" /></td>
						<td>
							&nbsp;</td>
					</tr>
				</tbody>
			</table>
		</div>
		<p>
			<button onclick="queryclear()" type="button">Clear</button><button onclick="queryattributes()" type="button">Submit</button><br />
			</p>
</div>

</div>
 </div>
 
 
 
<!-- Flat Details Sidebar-->
 <div id="sidebar_detail"> 
<h2>Accomodation details:</h2>
<form>
  <fieldset>
    <legend>Address</legend>
    <table>
      <tr>
        <td><b>Street:</b></td>
        <td><div id="street"> </div></td>
      </tr><tr>
        <td><b>Zip:</b></td>
        <td><div id="zip"> </div></td>
      </tr><tr>
        <td><b>City:</b></td>
        <td><div id="city"> </div></td>
      </tr>
    </table>
  </fieldset>
  <br>
  <fieldset>
    <legend>Description</legend>
    <table>
      <tr>
        <td><b>Type:</b></td>
        <td><div id="type"> </div></td>
      </tr><tr>
        <td><b>Price:[ € ]</b></td>
        <td><div id="price"> </div></td>
      </tr><tr>
        <td><b>Size:[ m² ]</b></td>
        <td><div id="area"> </div></td>
      </tr><tr>
        <td><b>Rooms:</b></td>
        <td><div id="rooms"> </div></td>
      </tr><tr>
        <td><b>Fellow lodger:</b></td>
        <td><div id="fellowlodger"> </div></td>
      </tr><tr>
        <td><b>Available:</b></td>
        <td><div id="moveindate"> </div></td>
      </tr>
    </table>
  </fieldset>
  <!--
  <fieldset>
    <legend>Additional Information</legend>
    <table>
	<tr>
        <td><b>Information:</b></td>
        <td><div id="information"> </div></td>
      </tr><tr>
        <td><b>Contacts:</b></td>
        <td><div id="contacts"> Tel: 0000/0000</div></td>
		<td><div id="contacts2"> Test@Test.de</div></td>
      </tr>
	  </table>
  </fieldset>
   -->
</form>
	
	
	</div> 

<div id="sidebarqlocation"> 



<p>
			<span style="color: #3366ff;"><strong><span style="font-size: medium;">Add a distance for your area of interest</span></strong></span><img alt="" src="libraries/Images/Search3.png" style="width: 100px; height: 100px" /></p>
<form>
 <table border="0" cellpadding="0" cellspacing="4">
    <tr>
      <td align="right">Distance [km]</td>
      <td><input id="inputDistance"  type="text" size="30" maxlength="30"></td>
    </tr>    
  </table>
</form>
</div>
<script>

mylocation();

//Speech
   function startButton(event) {
            final_transcript = '';
            recognition.start();
        }










//create map
var map = new L.Map('map', {
            //crs: L.CRS.EPSG3857,
            center: [51.95442, 7.62709],
            zoom: 14});

//sidebar
var sidebar = L.control.sidebar('sidebar', {
    position: 'right'
});

var sidebarLinks = L.control.sidebar('sidebarLinks', {
    position: 'right'
});

//sidebar
var sidebarqlocation = L.control.sidebar('sidebarqlocation', {
    position: 'right'
});


//sidebar_detail
var sidebar_detail = L.control.sidebar('sidebar_detail', {
    position: 'right'
});
	
var AddAccomodationsidebar = L.control.sidebar('AddAccomodationsidebar', {
    position: 'right'
});

var insertObservationSidebar = L.control.sidebar('InsertObservationSidebar', {position: 'right'});












//observation sidebar
var obs_sidebar = L.control.sidebar('observation_sidebar', {
    position: 'right'
});

map.addControl(sidebar);
map.addControl(sidebar_detail);
map.addControl(sidebarqlocation);
map.addControl(AddAccomodationsidebar);
map.addControl(insertObservationSidebar);
map.addControl(obs_sidebar);
map.addControl(sidebarLinks);
function ShowSidebar()
{
sidebar.show();
}


//function to get all the data from the WFS/Json

function loadGeoJson(data) {
myLayer.addData(data); 
}

var geoJsonUrl ="http://giv-siidemo.uni-muenster.de:8080/geoserver/group10ws/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=group10ws:flats&format=text/javascript&outputFormat=json&format_options=callback:loadGeoJson";
$.ajax({ 
        url: geoJsonUrl, 
        dataType: 'jsonp' 
}); 

function alldata(data){
var geoJsonUrl ="http://giv-siidemo.uni-muenster.de:8080/geoserver/group10ws/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=group10ws:flats&format=text/javascript&outputFormat=json&format_options=callback:loadGeoJson";
$.ajax({ 
        url: geoJsonUrl, 
        dataType: 'jsonp' 
}); 
}





//Query by filter


function initialvariables(){
	qsizemin=-1;
	qsizemax=-1;
	qpricemin=-1;
	qpricemax=-1;
	qflats=-1;
	gfsc=-1;
	qmaxlodger=-1;
	qminlodger=-1;
	qmaxroom=-1;
	qminroom=-1;
	qzip=-1;
}

function Query(){
	queryclear();
	sidebar.show();	
}

function queryattributes(){
	qsizemin=document.getElementById('qsizemin').value;
	qsizemax=document.getElementById('qsizemax').value;
	qpricemin=document.getElementById('qpricemin').value;
	qpricemax=document.getElementById('qpricemax').value;
	if (document.getElementById('qflat').checked==true)
		qflats=1;
	if (document.getElementById('qfsc').checked==true)
		gfsc=1;
	qmaxlodger=document.getElementById('qmaxlodger').value;
	qminlodger=document.getElementById('qminlodger').value;
	qmaxroom=document.getElementById('qmaxroom').value;
	qminroom=document.getElementById('qminroom').value;
	qzip=document.getElementById('qzip').value;
	
	var geoJsonquery ="http://giv-siidemo.uni-muenster.de:8080/geoserver/group10ws/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=group10ws:flats&Filter=<Filter><And>"
	if (qsizemin != ''){
	geoJsonquery +="<PropertyIsGreaterThanOrEqualTo><PropertyName>area</PropertyName><Literal>"
	geoJsonquery +=qsizemin
	geoJsonquery +="</Literal></PropertyIsGreaterThanOrEqualTo>"
	}
	
	if (qsizemax != ''){
	geoJsonquery +="<PropertyIsLessThanOrEqualTo><PropertyName>area</PropertyName><Literal>"
	geoJsonquery +=qsizemax
	geoJsonquery +="</Literal></PropertyIsLessThanOrEqualTo>"
	}
	
	if (qpricemin != ''){
	geoJsonquery +="<PropertyIsGreaterThanOrEqualTo><PropertyName>price</PropertyName><Literal>"
	geoJsonquery +=qpricemin
	geoJsonquery +="</Literal></PropertyIsGreaterThanOrEqualTo>"
	}
	
	if (qpricemax != ''){
	geoJsonquery +="<PropertyIsLessThanOrEqualTo><PropertyName>price</PropertyName><Literal>"
	geoJsonquery +=qpricemax
	geoJsonquery +="</Literal></PropertyIsLessThanOrEqualTo>"
	}
	
	//if (qflats == 1){
	//geoJsonquery +="<PropertyIsEqualTo><PropertyName>price</PropertyName><Literal>"
	//geoJsonquery +=qpricemax
	//geoJsonquery +="</Literal></PropertyIsEqualTo>"
	//}
	
	//if (qfsc == 1){
	//geoJsonquery +="<PropertyIsEqualTo><PropertyName>price</PropertyName><Literal>"
	//geoJsonquery +=qpricemax
	//geoJsonquery +="</Literal></PropertyIsEqualTo>"
	//}
	
	//if (qmaxlodger != ''){
	//geoJsonquery +="<PropertyIsLessThanOrEqualTo><PropertyName>price</PropertyName><Literal>"
	//geoJsonquery +=qpricemax
	//geoJsonquery +="</Literal></PropertyIsLessThanOrEqualTo>"
	//}
	
	//if (qminlodger != ''){
	//geoJsonquery +="<PropertyIsLessThanOrEqualTo><PropertyName>price</PropertyName><Literal>"
	//geoJsonquery +=qpricemax
	//geoJsonquery +="</Literal></PropertyIsLessThanOrEqualTo>"
	//}
	
	if(qminroom != ''){
	geoJsonquery +="<PropertyIsGreaterThanOrEqualTo><PropertyName>rooms</PropertyName><Literal>"
	geoJsonquery +=qminroom
	geoJsonquery +="</Literal></PropertyIsGreaterThanOrEqualTo>"
	}
	
	if(qmaxroom != ''){
	geoJsonquery +="<PropertyIsLessThanOrEqualTo><PropertyName>rooms</PropertyName><Literal>"
	geoJsonquery +=qmaxroom
	geoJsonquery +="</Literal></PropertyIsLessThanOrEqualTo>"
	}
	
	if(qzip != ''){
	geoJsonquery +="<PropertyIsEqualTo><PropertyName>zip</PropertyName><Literal>"
	geoJsonquery +=qzip
	geoJsonquery +="</Literal></PropertyIsEqualTo>"
	}
	
	geoJsonquery +="</And></Filter>&format=text/javascript&outputFormat=json&format_options=callback:loadGeoJsonQuery";
	
	alert(geoJsonUrl);
	
	$.ajax({ 
        url: geoJsonquery, 
        dataType: 'jsonp' 
}); 
}

function onEachFeaturequery(feature, layer){
document.getElementById('divtable').innerHTML = '<tr><td>feature.properties.Street</td><td>feature.properties.rooms</td></tr>';
}

function loadGeoJsonQuery(data) {
myLayer.clearLayers();
myLayer.addData(data);

}

function queryclear(){
	document.getElementById('qsizemin').value='';
	document.getElementById('qsizemax').value='';
	document.getElementById('qpricemin').value='';
	document.getElementById('qpricemax').value='';
	document.getElementById('qflat').checked=false;
	document.getElementById('qfsc').checked=false;
	document.getElementById('qmaxlodger').value='';
	document.getElementById('qminlodger').value='';
	document.getElementById('qmaxroom').value='';
	document.getElementById('qminroom').value='';
	document.getElementById('qzip').value='';
	
	initialvariables()
}

function Querylocation(location){
	sidebarqlocation.show();
	
	


 var distance = 1;
  $("#inputDistance").val(distance);
 var latLong=[ lat,lon];
 




var currentPositionMarker = L.marker([lat, lon], 
            {icon: L.AwesomeMarkers.icon({icon: 'spinner', prefix: 'fa', markerColor: 'red', spin:true})});
  currentPositionMarker.addTo(map);
  
 
  
 
  currentDiameter = L.circle(latLong, distance * 1000);
  currentDiameter.addTo(map);
 


  $("#inputDistance").change(function() {	
    map.removeLayer(currentDiameter);
    currentDiameter = L.circle(currentPositionMarker.getLatLng(), $("#inputDistance").val() * 1000);
    currentDiameter.addTo(map);

  });

	
}

function QuerylocationEnd(){
	
	sidebarqlocation.hide();
map.removeLayer(currentDiameter);



	
}








function submitquerylocation(){
		
var geoJsonUrl ="http://giv-siidemo.uni-muenster.de:8080/geoserver/group10ws/ows?service=WFS?request=GetFeature&version=1.0.0&service=wfs&outputformat=json&cql_filter=DWITHIN(the_geom,POINT(51.9544017,7.6213766),1,kilometers,4326)&typeName=group10ws:flats&&format=text/javascript&outputFormat=json&format_options=callback:loadGeoJsonQuery";







/*
"http://giv-siidemo.uni-muenster.de:8080/geoserver/group10ws/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=group10ws:flats&"
geoJsonUrl +="Filter=<Filter xmlns=\"http://www.opengis.net/ogc\"  xmlns:gml=\"http://www.opengis.net/gml\"><DWithin><PropertyName>the_geom</PropertyName><gml:Point><gml:coordinates>"
geoJsonUrl +=lat
geoJsonUrl +=","
geoJsonUrl +=lon
geoJsonUrl +="</gml:coordinates></gml:Point><Distance units='km'>3</Distance></DWithin></Filter>"
geoJsonUrl +="&format=text/javascript&outputFormat=json&format_options=callback:loadGeoJsonQuery";*/

alert(geoJsonUrl)

$.ajax({ 
        url: geoJsonUrl, 
        dataType: 'jsonp' 
}); 





}

map.on('locationerror', onLocationError);

function LinksShow()
{
sidebarLinks.show();
}




// Add a marker

//-----------------------
function AddAccomod(Coord){
	AddAccomodationsidebar.show();
	$.get( "AddNewAccomodation.php?Coord="+Coord, function( data ) {
	document.getElementById('NewAccomationCoordinates').innerHTML = data;
	});
}

function InsertObservation(coordinate)	{
	
	obs_sidebar.show();		
	var index = coordinate.indexOf(",");
	
	var longitude = coordinate.substring(0,index);
	var latitude = coordinate.substring(index+1);
	
	var longi = longitude.split(".");
	var lati = latitude.split(".");
	
	document.getElementById("obsLongitude").value = longi[0] + "." + longi[1].substring(0, 6);  //coordinate.substring(0,index); 
	document.getElementById("obsLatitude").value = lati[0] + "." + lati[1].substring(0, 6); //coordinate.substring(index+1);
}


function InvokeMarker(Coord){
	new L.Draw.Marker(map, drawControl.options.marker).enable( )// to invoke draw Marker command 
}


//???
function Observation(){
/*


	alert('yes');
	
	obs_sidebar.show();	
	alert('lat');
	alert(document.getElementById('lat').value);
	document.getElementById('obsLatitude').value = document.getElementById('lat').value;
	alert('obslat');
	alert(document.getElementById('obsLatitude').value);
	*/
}

// Functions for adding new flats by formular 
function addRoomDetails()	{		
					
	var getUrl = "submit.php?";
	getUrl += "obsLatitude=" + document.getElementById("obsLatitude").value + "&";				
	getUrl += "obsLongitude=" + document.getElementById("obsLongitude").value + "&";				
	getUrl += "obsStreet=" + document.getElementById("obsStreet").value + "&";				
	getUrl += "obsZip=" + document.getElementById("obsZip").value + "&";
	getUrl += "obsCity=" + document.getElementById("obsCity").value + "&";
	getUrl += "obsArea=" + document.getElementById("obsArea").value + "&";
	getUrl += "obsRent=" + document.getElementById("obsRent").value + "&";
	//getUrl += "obsType=" + document.getElementById("obsType").value + "&";
	
	if(document.getElementById("obsTypeFlat").checked)
		getUrl += "obsType=Flat&";
	else if(document.getElementById("obsTypeWG").checked)
		getUrl += "obsType=WG&";
	
	getUrl += "obsFellowLodger=" + document.getElementById("obsFellowLodger").value + "&";
	getUrl += "obsNoOfRoom=" + document.getElementById("obsNoOfRoom").value + "&";
	getUrl += "obsDate=" + document.getElementById("obsDate").value + "&";				
	getUrl += "obsInformation=" + document.getElementById("obsInformation").value;
				
	$.ajax({					
		type: "GET",
		url: getUrl,					
		data: { }
	}).done(function( msg ) {					
					
		msg = msg.toLowerCase();
		if(msg.indexOf("success") != -1)
			alert("Data saved succesfully");
		else
			alert("Error saving data");
	});
}

function clearRoomDetails()	{
	
	document.getElementById("obsLatitude").value = '';
	document.getElementById("obsLongitude").value = '';
	document.getElementById("obsStreet").value = '';
	document.getElementById("obsZip").value = '';
	document.getElementById("obsCity").value = '';
	document.getElementById("obsArea").value = '';
	document.getElementById("obsRent").value = '';
	//document.getElementById("obsType").value = '';
	
	document.getElementById("obsTypeFlat").checked = false;
	document.getElementById("obsTypeWG").checked = false;
	
	document.getElementById("obsFellowLodger").value = '';
	document.getElementById("obsNoOfRoom").value = '';
	document.getElementById("obsDate").value = '';
	document.getElementById("obsInformation").value = '';
}










//

// function for the sidebar to display more details

 


// get the data from an point from the each feature function and display it in the sidebar

function MyFunction(name){


//alert(name);
var array = name.split(',')

var street_space=array[10].replace(/_/g, ' ');

var information_space=array[6].replace(/_/g, ' ');

document.getElementById("street").innerHTML=street_space;
document.getElementById("zip").innerHTML=array[3];
document.getElementById("city").innerHTML=array[2];
document.getElementById("type").innerHTML=array[7];
document.getElementById("price").innerHTML=array[0];
document.getElementById("rooms").innerHTML=array[4];
document.getElementById("area").innerHTML=array[5];
document.getElementById("fellowlodger").innerHTML=array[8];
document.getElementById("moveindate").innerHTML=array[9];
//document.getElementById("information").innerHTML=information_space;



sidebar_detail.show();
 
}





//Adding WFS Layer by JSON Format

	var myLayer = new L.geoJson(null,{
onEachFeature: function 
(feature, layer) 
{


//'Street:'+feature.properties.Street+
//'<br>Rooms:'+feature.properties.rooms+'<br><a onclick="MyFunction()">See details</a>'


var information=feature.properties.information.replace(/ /g, '_');
var information2=information.replace(/,/g, '.');
var Street=feature.properties.Street.replace(/ /g, '_');
var movein2=feature.properties.movein_date.toString();
var movein = movein2.substr(0, movein2.length-1); 

layer.bindPopup('Street:'+feature.properties.Street+
'<br>Rooms:'+feature.properties.rooms+'<br>Type:'+feature.properties.type+'<br>Price:'+feature.properties.price+'<br>Available from:'+movein+'<br><a name='+feature.properties.price+','+feature.properties.id+','+feature.properties.city+','+feature.properties.zip+','+feature.properties.rooms+','+feature.properties.area+','+information2+','+feature.properties.type+','+feature.properties.fellowlodger+','+movein+','+Street+' onclick="MyFunction(name)">See details</a>'

);




},



 pointToLayer: function(feature, latlng) {
        return new L.marker(latlng, {icon: L.AwesomeMarkers.icon({icon: 'home', prefix: 'fa', markerColor: 'green', spin:false}) });
		return new L.CircleMarker(latlng, {radius: 10, fillOpacity: 0.85});
    },


 
}).addTo(map);
/*
L.marker.click( function(e) {
    L.marker.markerColor= 'red';
});
*/
/*
L.geoJson(geoJson, {
    pointToLayer: function (feature, latlng) {
        return L.marker(latlng, 
            {icon: L.AwesomeMarkers.icon({icon: 'spinner', prefix: 'fa', markerColor: 'red', spin:true})};
    }

	
	}).addTo(map);


*/






var layer1=L.tileLayer('http://{s}.tile.cloudmade.com/BC9A493B41014CAABB98F0471D759707/997/256/{z}/{x}/{y}.png', {
    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a>'
+' contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>,'
+'Imagery &copy <a href="http://cloudmade.com">CloudMade</a>',
    maxZoom: 18
});

layer1.addTo(map);




		
//OSM maps one as overlay and one base layer 
var osmUrl='http://a.tile.openstreetmap.org/{z}/{x}/{y}.png';
var osmAttrib='Map data &copy; OpenStreetMap contributors';
var layerOSM=L.tileLayer(osmUrl, {minZoom: 0, maxZoom: 18, attribution: osmAttrib});
var layerOSMtransparent=L.tileLayer('http://a.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy<a href="www.openstretmap.org/copyright ">OpenStreetMap</a> contributors',
	opacity:0.5,
    format: 'image/png',
	
});
//Layers of Geobasis NRW: http://www.bezreg-koeln.nrw.de/brk_internet/organisation/abteilung07/produkte/nrwatlas/index.html 
//                          (website which provides different Web Map Service (WMS)-URLs)
var layerDTK10_pan=L.tileLayer.wms('http://www.wms.nrw.de/geobasis/wms_nw_dtk10', {
   attribution: '| &copy Geobasis NRW 2013',
	layers: 'NW_DTK10_pan',
    format: 'image/png',
    transparent: true,
	opacity:0.4	
});
var layerDTK10=L.tileLayer.wms('http://www.wms.nrw.de/geobasis/wms_nw_dtk10', {
     attribution: '| &copy Geobasis NRW 2013',
	layers: 'nw_dtk10_pan,nw_dtk10_res,NW_DTK10_col,WMS_NW_DTK10',
    format: 'image/png',
    transparent: true
});
//layer of the different districts
var layerDVG=L.tileLayer.wms('http://www.wms.nrw.de/geobasis/wms_nw_dvg', {
     attribution: '| &copy Geobasis NRW 2013',
	layers: 'WMS_NW_DVG',
    format: 'image/png',
    transparent: true,
	opacity:0.5
});
var layerDGK5=L.tileLayer.wms('http://www.wms.nrw.de/geobasis/wms_nw_dgk5', {
 attribution: '| &copy Geobasis NRW 2013',
	layers: 'WMS_NW_DGK5',
    format: 'image/png',
    transparent: true,
	opacity:0.5
});
//Orthophoto layer
var layerOrtho = L.tileLayer.wms('http://www.wms.nrw.de/geobasis/wms_nw_dop40', {
    layers: 'WMS_NW_DOP40',
    format: 'image/png',
	version:'1.3.0',
    attribution: '| &copy Geobasis NRW 2013'
});

// Noisemap

 var laerm_night = new L.TileLayer.WMS("https://www.wms.nrw.de/umwelt/laerm", {
            layers: 'STR_NGT',
            format: 'image/png',
            crs: L.CRS.EPSG4326,
            version: '1.3.0',
            transparent: true,
            opacity: 0.5
        });

var laerm_24 = new L.TileLayer.WMS("https://www.wms.nrw.de/umwelt/laerm", {
            layers: 'STR_DEN',
            format: 'image/png',
            crs: L.CRS.EPSG4326,
            version: '1.3.0',
            transparent: true,
            opacity: 0.5
        });
		
var leisure = new L.TileLayer.WMS("http://www.wms.nrw.de/geobasis/wms_nw_fzk", {
            layers: 'nw_fzk',
            format: 'image/png',
            //crs: L.CRS.EPSG4326,
            version: '1.1.1',
            transparent: true,
            opacity: 0.5
        });
		
//The map which is visualized when you get on the website.
layerOSM.addTo(map);

//Map control: Layer switcher
var baseMaps={ "OSM": layerOSM,
               "arial view": layerOrtho,
			   "DTK10":layerDTK10
               };
var overlapMaps={"OSM":layerOSMtransparent,
                  "DVG":layerDVG,
				  "DTK10_pan":layerDTK10_pan,
				  "DGK5":layerDGK5,
				  "NoiseStreet_Night":laerm_night,
                  "NoiseStreet_24h":laerm_24,
				  "Leisure_Cadastre":leisure
				  };

var control=L.control.layers(baseMaps,overlapMaps,{position:'bottomleft'}).addTo(map);






//miniMap
	var osm2 = new L.TileLayer(osmUrl, {minZoom: 0, maxZoom: 13, attribution: osmAttrib });
	var miniMap = new L.Control.MiniMap(osm2, { toggleDisplay: true }).addTo(map);

//measure Control 
	L.Control.measureControl().addTo(map);
	
	
//drawing tool
// Initialise the FeatureGroup to store editable layers
var drawnItems = new L.FeatureGroup();
map.addLayer(drawnItems);
// Set the title to show on the polygon button
		L.drawLocal.draw.toolbar.buttons.marker = 'Add New Accommodation';

// Initialise the draw control and pass it the FeatureGroup of editable layers





var drawControl = new L.Control.Draw({
    
	draw: {
			polyline: false,
			polygon:false,
			rectangle:false,
			circle:false,
			marker:{icon: L.AwesomeMarkers.icon({icon: 'home', prefix: 'fa', markerColor: 'blue', spin:false})},
			}
});
map.addControl(drawControl);

map.on('draw:created', function (e) {
    var type = e.layerType,
        layer = e.layer;

    if (type === 'marker') {
        // Do marker specific actions
		var coordinates = layer.toGeoJSON().geometry.coordinates;
		var coord = coordinates.toString();
				
		InsertObservation(coord);
		//AddAccomod(coord);
    }

    // Do whatever else you need to. (save to db, add to map etc)
    map.addLayer(layer);
});


	
//getlocation
map.locate({setView: true, maxZoom: 16});

function mylocation()
{
navigator.geolocation.getCurrentPosition(GetLocation)
}

function GetLocation(location){
lat=location.coords.latitude;
lon=location.coords.longitude;
accuracy = location.coords.accuracy;

AddMarker(lat, lon, accuracy);

}

function AddMarker(latitude, longitude, accuracy)	{
	var radius = accuracy / 4;
	
    L.marker([latitude, longitude],{icon: L.AwesomeMarkers.icon({icon: 'spinner', prefix: 'fa', markerColor: 'blue', spin:true}) }).addTo(map);
    L.circle([latitude, longitude], radius).addTo(map);
}

function onLocationFound(e) {
    var radius = e.accuracy / 2;

    L.marker(e.latlng,{icon: L.AwesomeMarkers.icon({icon: 'spinner', prefix: 'fa', markerColor: 'red', spin:true}) }).addTo(map)
        .bindPopup("You are within " + radius + " meters from this point. Do you want to start a query with this location?").openPopup();

    L.circle(e.latlng, radius).addTo(map);
	
	//lat=e.coords.latitude;
	//lon=e.coords.longitude;
	
}

map.on('locationfound', onLocationFound);

function onLocationError(e) {
    alert(e.message);
}



 





</script>
</div>
</div>
	</body>
	</html>
